<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>C25Tool â€¢ Bot Portal</title>
  <meta name="description" content="Web Portal dÃ nh cho User & Admin - káº¿t ná»‘i vá»›i Discord Bot API"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass{background:rgba(255,255,255,.08);backdrop-filter: blur(12px);border:1px solid rgba(255,255,255,.12)}
    .soft{box-shadow:0 20px 60px rgba(0,0,0,.35)}
    .grad{background:radial-gradient(1200px 700px at 20% 10%, rgba(88,101,242,.35), transparent 55%),
                 radial-gradient(900px 600px at 85% 25%, rgba(46,204,113,.28), transparent 55%),
                 radial-gradient(900px 600px at 50% 100%, rgba(231,76,60,.24), transparent 55%),
                 linear-gradient(180deg, #0b1020, #070a12);}
    .chip{border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.06)}
    .btn{transition:transform .12s ease, filter .12s ease;}
    .btn:active{transform:scale(.98);}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
  </style>
</head>
<body class="grad min-h-screen text-white">
  <div class="max-w-7xl mx-auto px-4 py-6">
    <div class="flex flex-col md:flex-row gap-4 md:items-center md:justify-between">
      <div class="flex items-center gap-3">
        <div class="w-11 h-11 rounded-2xl bg-indigo-500/20 grid place-items-center soft"><span class="text-2xl">âš¡</span></div>
        <div>
          <div class="text-xl font-bold">C25Tool â€¢ Bot Portal</div>
          <div class="text-white/60 text-sm">User Dashboard + Admin Panel â€¢ káº¿t ná»‘i Discord Bot API</div>
        </div>
      </div>
      <div class="flex gap-2 flex-wrap">
        <button class="btn px-4 py-2 rounded-2xl chip hover:bg-white/10" onclick="go('home')">ğŸ  Trang chá»§</button>
        <button class="btn px-4 py-2 rounded-2xl chip hover:bg-white/10" onclick="go('commands')">ğŸ“– Lá»‡nh</button>
        <button class="btn px-4 py-2 rounded-2xl chip hover:bg-white/10" onclick="go('user')">ğŸ‘¤ User</button>
        <button class="btn px-4 py-2 rounded-2xl chip hover:bg-white/10" onclick="go('admin')">ğŸ›¡ï¸ Admin</button>
        <button class="btn px-4 py-2 rounded-2xl chip hover:bg-white/10" onclick="openSettings()">âš™ï¸ API</button>
      </div>
    </div>

    <div class="mt-6 glass rounded-3xl p-5 soft">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <div class="text-2xl font-extrabold">âœ¨ Portal Ä‘áº¹p kiá»ƒu Mimi â€¢ Netlify</div>
          <div class="text-white/70 mt-1">
            âœ… User láº¥y token Discord: <span class="mono">/token</span> (bot DM) â€¢ Reset: <span class="mono">/token reset</span><br/>
            âœ… Admin Ä‘Äƒng nháº­p quáº£n lÃ½ qua Web API cá»§a bot.
          </div>
        </div>
        <div class="flex gap-2 flex-wrap">
          <a class="btn px-4 py-2 rounded-2xl bg-indigo-500/80 hover:bg-indigo-500" href="#" onclick="go('user')">Báº¯t Ä‘áº§u User</a>
          <a class="btn px-4 py-2 rounded-2xl bg-emerald-500/80 hover:bg-emerald-500" href="#" onclick="go('admin')">Báº¯t Ä‘áº§u Admin</a>
        </div>
      </div>
    </div>

    <div class="grid lg:grid-cols-12 gap-6 mt-6">
      <div class="lg:col-span-4">
        <div class="glass rounded-3xl p-5 soft">
          <div class="font-bold text-lg">ğŸ“Œ Tráº¡ng thÃ¡i káº¿t ná»‘i</div>
          <div class="mt-3 space-y-2 text-sm">
            <div class="flex items-center justify-between chip rounded-2xl px-3 py-2">
              <span class="text-white/70">API Base</span>
              <span class="mono" id="apiBaseTxt">â€”</span>
            </div>
            <div class="flex items-center justify-between chip rounded-2xl px-3 py-2">
              <span class="text-white/70">API Health</span>
              <span id="apiHealthTxt" class="text-white/60">chÆ°a kiá»ƒm tra</span>
            </div>
            <div class="flex items-center justify-between chip rounded-2xl px-3 py-2">
              <span class="text-white/70">User</span>
              <span id="userStatusTxt" class="text-white/60">chÆ°a Ä‘Äƒng nháº­p</span>
            </div>
            <div class="flex items-center justify-between chip rounded-2xl px-3 py-2">
              <span class="text-white/70">Admin</span>
              <span id="adminStatusTxt" class="text-white/60">chÆ°a Ä‘Äƒng nháº­p</span>
            </div>
          </div>
          <div class="mt-4 flex gap-2 flex-wrap">
            <button class="btn px-4 py-2 rounded-2xl bg-white/10 hover:bg-white/15" onclick="checkHealth()">ğŸ”Œ Check API</button>
            <button class="btn px-4 py-2 rounded-2xl bg-white/10 hover:bg-white/15" onclick="logoutAll()">ğŸšª Logout</button>
          </div>
          <div class="mt-5 border-t border-white/10 pt-5">
            <div class="font-bold">âš ï¸ LÆ°u Ã½</div>
            <ul class="text-white/70 text-sm mt-2 list-disc pl-5 space-y-1">
              <li>Netlify chá»‰ host <b>front-end</b> â†’ bot pháº£i má»Ÿ <b>Web API</b> (port 8080).</li>
              <li>Token user lÃ  bÃ­ máº­t, khÃ´ng share.</li>
              <li>KhÃ´ng nÃªn hard-code máº­t kháº©u admin trong web náº¿u dÃ¹ng public.</li>
            </ul>
          </div>
        </div>

        <div class="glass rounded-3xl p-5 soft mt-6">
          <div class="font-bold text-lg">ğŸ“ Link nhanh</div>
          <div class="grid grid-cols-2 gap-2 mt-3 text-sm">
            <a class="btn chip rounded-2xl px-3 py-2 hover:bg-white/10" target="_blank" href="https://facebook.com/anhyeuemnhamlun">Facebook</a>
            <a class="btn chip rounded-2xl px-3 py-2 hover:bg-white/10" target="_blank" href="https://zalo.me/0763465951">Zalo</a>
            <a class="btn chip rounded-2xl px-3 py-2 hover:bg-white/10" target="_blank" href="https://t.me/tuanank209">Telegram</a>
            <a class="btn chip rounded-2xl px-3 py-2 hover:bg-white/10" target="_blank" href="https://discord.com/oauth2/authorize?client_id=1459868186361991373&permissions=8&integration_type=0&scope=bot">Add Bot</a>
          </div>
        </div>
      </div>

      <div class="lg:col-span-8">
        <div id="page-home" class="page glass rounded-3xl p-6 soft">
          <div class="text-2xl font-extrabold">ğŸš€ Portal tá»•ng</div>
          <div class="text-white/70 mt-2">
            Chá»n tab <b>User</b> hoáº·c <b>Admin</b> Ä‘á»ƒ báº¯t Ä‘áº§u. DÃ¹ng nÃºt <b>âš™ï¸ API</b> Ä‘á»ƒ nháº­p API Base.
          </div>
          <div class="grid md:grid-cols-2 gap-4 mt-6">
            <div class="glass rounded-3xl p-5">
              <div class="font-bold text-lg">ğŸ‘¤ User Dashboard</div>
              <div class="text-white/70 text-sm mt-1">Login báº±ng token Discord DM.</div>
              <button class="btn mt-4 px-4 py-2 rounded-2xl bg-indigo-500/80 hover:bg-indigo-500" onclick="go('user')">VÃ o User</button>
            </div>
            <div class="glass rounded-3xl p-5">
              <div class="font-bold text-lg">ğŸ›¡ï¸ Admin Panel</div>
              <div class="text-white/70 text-sm mt-1">Quáº£n lÃ½ há»‡ thá»‘ng bot qua API.</div>
              <button class="btn mt-4 px-4 py-2 rounded-2xl bg-emerald-500/80 hover:bg-emerald-500" onclick="go('admin')">VÃ o Admin</button>
            </div>
          </div>
        </div>

        <div id="page-commands" class="page hidden glass rounded-3xl p-6 soft">
          <div class="flex items-center justify-between gap-3">
            <div>
              <div class="text-2xl font-extrabold">ğŸ“– Danh sÃ¡ch lá»‡nh</div>
              <div class="text-white/70 mt-1">Tá»•ng há»£p lá»‡nh MAX trong bot.</div>
            </div>
            <button class="btn px-4 py-2 rounded-2xl bg-white/10 hover:bg-white/15" onclick="copyCommands()">ğŸ“‹ Copy</button>
          </div>
          <div class="grid md:grid-cols-2 gap-4 mt-6 text-sm">
            <div class="glass rounded-3xl p-5"><div class="font-bold">ğŸ§° Tiá»‡n Ã­ch</div><div class="mt-2 text-white/70 mono" id="cmd-utils"></div></div>
            <div class="glass rounded-3xl p-5"><div class="font-bold">ğŸ’° Kinh táº¿</div><div class="mt-2 text-white/70 mono" id="cmd-eco"></div></div>
            <div class="glass rounded-3xl p-5"><div class="font-bold">ğŸ® Game</div><div class="mt-2 text-white/70 mono" id="cmd-games"></div></div>
            <div class="glass rounded-3xl p-5"><div class="font-bold">ğŸ­ Giáº£i trÃ­</div><div class="mt-2 text-white/70 mono" id="cmd-fun"></div></div>
            <div class="glass rounded-3xl p-5 md:col-span-2"><div class="font-bold">ğŸ›¡ï¸ Admin</div><div class="mt-2 text-white/70 mono" id="cmd-admin"></div></div>
          </div>
        </div>

        <div id="page-user" class="page hidden glass rounded-3xl p-6 soft">
          <div class="flex items-center justify-between gap-3">
            <div>
              <div class="text-2xl font-extrabold">ğŸ‘¤ User Dashboard</div>
              <div class="text-white/70 mt-1">ÄÄƒng nháº­p báº±ng token láº¥y tá»« Discord DM.</div>
            </div>
            <div class="flex gap-2 flex-wrap">
              <button class="btn px-4 py-2 rounded-2xl bg-white/10 hover:bg-white/15" onclick="userLogout()">ğŸšª Logout</button>
              <button class="btn px-4 py-2 rounded-2xl bg-indigo-500/80 hover:bg-indigo-500" onclick="userRefresh()">ğŸ”„ Refresh</button>
            </div>
          </div>

          <div id="userLoginBox" class="mt-6 glass rounded-3xl p-5">
            <div class="font-bold text-lg">ğŸ”‘ ÄÄƒng nháº­p User</div>
            <div class="text-white/70 text-sm mt-1">DÃ¹ng <span class="mono">/token</span> Ä‘á»ƒ nháº­n token (DM) â€¢ reset: <span class="mono">/token reset</span></div>
            <div class="mt-4 grid md:grid-cols-3 gap-3">
              <div class="md:col-span-2">
                <label class="text-white/70 text-sm">Token</label>
                <input id="userTokenInput" class="w-full mt-1 px-4 py-3 rounded-2xl bg-white/10 border border-white/10 outline-none mono" placeholder="DÃ¡n token 30 kÃ½ tá»±..." maxlength="60"/>
              </div>
              <div class="flex items-end">
                <button id="userLoginBtn" class="btn w-full px-4 py-3 rounded-2xl bg-indigo-500/80 hover:bg-indigo-500">Login</button>
              </div>
            </div>
            <div class="mt-3 text-white/60 text-sm" id="userLoginMsg">â€”</div>
          </div>

          <div id="userDash" class="hidden mt-6 grid md:grid-cols-2 gap-4">
            <div class="glass rounded-3xl p-5">
              <div class="font-bold text-lg">ğŸ’³ VÃ­ & Rank</div>
              <div class="mt-3 space-y-2 text-sm">
                <div class="flex items-center justify-between chip rounded-2xl px-3 py-2"><span class="text-white/70">Coin</span><span id="uCoin" class="font-bold">â€”</span></div>
                <div class="flex items-center justify-between chip rounded-2xl px-3 py-2"><span class="text-white/70">Level</span><span id="uLevel" class="font-bold">â€”</span></div>
                <div class="flex items-center justify-between chip rounded-2xl px-3 py-2"><span class="text-white/70">XP</span><span id="uXp" class="font-bold">â€”</span></div>
              </div>
            </div>
            <div class="glass rounded-3xl p-5">
              <div class="font-bold text-lg">ğŸ¦ Bank & Kho</div>
              <div class="mt-3 space-y-2 text-sm">
                <div class="chip rounded-2xl px-3 py-2"><div class="text-white/70">Bank</div><div id="uBank" class="mono text-white/80 mt-1">â€”</div></div>
                <div class="chip rounded-2xl px-3 py-2"><div class="text-white/70">Inventory</div><div id="uInv" class="mono text-white/80 mt-1">â€”</div></div>
              </div>
            </div>
          </div>
        </div>

        <div id="page-admin" class="page hidden glass rounded-3xl p-6 soft">
          <div class="flex items-center justify-between gap-3">
            <div>
              <div class="text-2xl font-extrabold">ğŸ›¡ï¸ Admin Panel</div>
              <div class="text-white/70 mt-1">Quáº£n lÃ½ bot qua Web API.</div>
            </div>
            <div class="flex gap-2 flex-wrap">
              <button class="btn px-4 py-2 rounded-2xl bg-white/10 hover:bg-white/15" onclick="adminLogout()">ğŸšª Logout</button>
              <button class="btn px-4 py-2 rounded-2xl bg-emerald-500/80 hover:bg-emerald-500" onclick="adminRefresh()">ğŸ”„ Refresh</button>
            </div>
          </div>

          <div id="adminLoginBox" class="mt-6 glass rounded-3xl p-5">
            <div class="font-bold text-lg">ğŸ” ÄÄƒng nháº­p Admin</div>
            <div class="text-white/70 text-sm mt-1">TÃ i khoáº£n/máº­t kháº©u theo yÃªu cáº§u: <span class="mono">admin / tuananh2009</span></div>
            <div class="mt-4 grid md:grid-cols-3 gap-3">
              <div><label class="text-white/70 text-sm">TÃ i khoáº£n</label><input id="adminUserInput" class="w-full mt-1 px-4 py-3 rounded-2xl bg-white/10 border border-white/10 outline-none" value="admin"/></div>
              <div><label class="text-white/70 text-sm">Máº­t kháº©u</label><input id="adminPassInput" type="password" class="w-full mt-1 px-4 py-3 rounded-2xl bg-white/10 border border-white/10 outline-none"/></div>
              <div class="flex items-end"><button id="adminLoginBtn" class="btn w-full px-4 py-3 rounded-2xl bg-emerald-500/80 hover:bg-emerald-500">Login</button></div>
            </div>
            <div class="mt-3 text-white/60 text-sm" id="adminLoginMsg">â€”</div>
          </div>

          <div id="adminDash" class="hidden mt-6 grid md:grid-cols-2 gap-4">
            <div class="glass rounded-3xl p-5">
              <div class="font-bold text-lg">ğŸ“Š Overview</div>
              <div class="mt-3 space-y-2 text-sm">
                <div class="flex items-center justify-between chip rounded-2xl px-3 py-2"><span class="text-white/70">Users</span><span id="aUsers" class="font-bold">â€”</span></div>
                <div class="flex items-center justify-between chip rounded-2xl px-3 py-2"><span class="text-white/70">Clans</span><span id="aClans" class="font-bold">â€”</span></div>
                <div class="flex items-center justify-between chip rounded-2xl px-3 py-2"><span class="text-white/70">Guilds</span><span id="aGuilds" class="font-bold">â€”</span></div>
                <div class="flex items-center justify-between chip rounded-2xl px-3 py-2"><span class="text-white/70">Pending Deposits</span><span id="aPend" class="font-bold">â€”</span></div>
              </div>
            </div>
            <div class="glass rounded-3xl p-5">
              <div class="font-bold text-lg">ğŸ‘¤ Tra cá»©u User</div>
              <div class="mt-3 flex gap-2">
                <input id="lookupUid" class="flex-1 px-4 py-3 rounded-2xl bg-white/10 border border-white/10 outline-none mono" placeholder="user_id"/>
                <button class="btn px-4 py-3 rounded-2xl bg-white/10 hover:bg-white/15" onclick="adminLookup()">ğŸ”</button>
              </div>
              <pre id="lookupResult" class="mt-3 chip rounded-2xl p-3 text-xs overflow-auto max-h-56 text-white/80 mono">â€”</pre>
            </div>
            <div class="glass rounded-3xl p-5 md:col-span-2">
              <div class="font-bold text-lg">â• Cá»™ng / Trá»« coin</div>
              <div class="mt-3 grid md:grid-cols-3 gap-3">
                <input id="coinUid" class="px-4 py-3 rounded-2xl bg-white/10 border border-white/10 outline-none mono" placeholder="user_id"/>
                <input id="coinDelta" class="px-4 py-3 rounded-2xl bg-white/10 border border-white/10 outline-none mono" placeholder="delta"/>
                <button class="btn px-4 py-3 rounded-2xl bg-emerald-500/80 hover:bg-emerald-500" onclick="adminAddCoin()">âœ… Thá»±c hiá»‡n</button>
              </div>
              <div class="mt-2 text-white/60 text-sm" id="coinMsg">â€”</div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div id="settingsModal" class="hidden fixed inset-0 bg-black/60 z-50 px-4">
      <div class="max-w-xl mx-auto mt-24 glass rounded-3xl p-6 soft">
        <div class="flex items-center justify-between">
          <div class="text-xl font-bold">âš™ï¸ API Settings</div>
          <button class="btn px-3 py-2 rounded-2xl bg-white/10 hover:bg-white/15" onclick="closeSettings()">âœ–ï¸</button>
        </div>
        <div class="text-white/70 text-sm mt-2">Nháº­p Ä‘á»‹a chá»‰ Web API cá»§a bot. VÃ­ dá»¥: <span class="mono">http://YOUR_VPS_IP:8080</span></div>
        <div class="mt-4">
          <label class="text-white/70 text-sm">API Base URL</label>
          <input id="apiBaseInput" class="w-full mt-1 px-4 py-3 rounded-2xl bg-white/10 border border-white/10 outline-none mono" placeholder="http://localhost:8080"/>
        </div>
        <div class="mt-4 flex gap-2 flex-wrap">
          <button class="btn px-4 py-2 rounded-2xl bg-indigo-500/80 hover:bg-indigo-500" onclick="saveApiBase()">ğŸ’¾ LÆ°u</button>
          <button class="btn px-4 py-2 rounded-2xl bg-white/10 hover:bg-white/15" onclick="checkHealth()">ğŸ”Œ Test</button>
        </div>
      </div>
    </div>
  </div>

<script>
  const COMMANDS = {
    utils: ["/menu","/help","/ping","/uptime","/avatar","/serverinfo","/stats","/rank","/toprank","/support","/remind","/myreminds","/delremind"],
    eco: ["/xemcoin","/napcoin","/getkey","/nhapkey","/nganhang","/mocnap","/vip","/shop","/muaitem","/kho","/work","/beg","/ancuop","/chuyencoin","/diemdanh","/token"],
    games:["/777","/taixiu","/nohu","/rps","/loto","/coinflip","/dice","/8ball","/choose"],
    fun:["/noitu","/anhgai","/anhtrai","/clan","/poll","/giveaway"],
    admin:["/on","/off","/lock","/band","/unband","/thongbao","/setlog","/setbotchannel","/cooldown","/autodelete","/backup","/restore","/buffcoin","/buffmocnap","/buffclan","/buffwin","/warn","/warns","/clearwarn","/timeout","/untimeout","/anticaps","/maxmentions"]
  };
  function renderCommands(){
    document.getElementById("cmd-utils").textContent = COMMANDS.utils.join("\n");
    document.getElementById("cmd-eco").textContent = COMMANDS.eco.join("\n");
    document.getElementById("cmd-games").textContent = COMMANDS.games.join("\n");
    document.getElementById("cmd-fun").textContent = COMMANDS.fun.join("\n");
    document.getElementById("cmd-admin").textContent = COMMANDS.admin.join("\n");
  }
  function copyCommands(){
    const all = Object.values(COMMANDS).flat().join("\n");
    navigator.clipboard.writeText(all).then(()=>toast("âœ… ÄÃ£ copy danh sÃ¡ch lá»‡nh"));
  }
  function go(page){
    document.querySelectorAll(".page").forEach(p=>p.classList.add("hidden"));
    document.getElementById("page-"+page).classList.remove("hidden");
    history.replaceState({}, "", "#"+page);
  }
  (function initRouter(){
    const hash = (location.hash || "#home").replace("#","");
    go(hash);
  })();

  function openSettings(){
    document.getElementById("settingsModal").classList.remove("hidden");
    document.getElementById("apiBaseInput").value = getApiBase();
  }
  function closeSettings(){ document.getElementById("settingsModal").classList.add("hidden"); }
  function getApiBase(){ return localStorage.getItem("API_BASE") || ""; }
  function setApiBase(v){
    localStorage.setItem("API_BASE", v);
    document.getElementById("apiBaseTxt").textContent = v || "â€”";
  }
  function saveApiBase(){
    const v = document.getElementById("apiBaseInput").value.trim().replace(/\/+$/,"");
    setApiBase(v);
    toast("âœ… ÄÃ£ lÆ°u API Base");
    closeSettings();
  }

  async function api(path, opts={}){
    const base = getApiBase();
    if(!base) throw new Error("NO_API_BASE");
    const url = base + path;
    const res = await fetch(url, opts);
    const text = await res.text();
    let data = null;
    try{ data = JSON.parse(text); }catch(e){ data = {raw:text}; }
    if(!res.ok) throw Object.assign(new Error("HTTP_"+res.status), {status:res.status, data});
    return data;
  }

  async function checkHealth(){
    try{
      const d = await api("/api/health");
      document.getElementById("apiHealthTxt").textContent = d.ok ? "âœ… OK" : "âš ï¸ lá»—i";
      toast("âœ… API OK");
    }catch(e){
      document.getElementById("apiHealthTxt").textContent = "âŒ KhÃ´ng káº¿t ná»‘i";
      toast("âŒ API lá»—i. Kiá»ƒm tra API Base + bot má»Ÿ port 8080");
    }
  }

  function userToken(){ return localStorage.getItem("USER_TOKEN") || ""; }
  function setUserToken(t){
    localStorage.setItem("USER_TOKEN", t);
    document.getElementById("userStatusTxt").textContent = t ? "âœ… logged" : "chÆ°a Ä‘Äƒng nháº­p";
  }
  function userLogout(){
    setUserToken("");
    document.getElementById("userDash").classList.add("hidden");
    document.getElementById("userLoginBox").classList.remove("hidden");
    toast("ğŸšª ÄÃ£ logout user");
  }

  let lockUserBtn=false;
  document.getElementById("userLoginBtn").addEventListener("click", async ()=>{
    if(lockUserBtn) return;
    lockUserBtn=true; setTimeout(()=>lockUserBtn=false,2500);
    const t = document.getElementById("userTokenInput").value.trim();
    const msg = document.getElementById("userLoginMsg");
    if(t.length < 10){ msg.textContent="âŒ Token khÃ´ng há»£p lá»‡"; return; }
    msg.textContent="â³ Äang Ä‘Äƒng nháº­p...";
    try{
      await api("/api/user/login", {method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify({token:t})});
      setUserToken(t);
      msg.textContent="âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng!";
      await userRefresh();
    }catch(e){
      msg.textContent="âŒ Sai token hoáº·c API lá»—i.";
      toast("âŒ Login tháº¥t báº¡i");
    }
  });

  async function userRefresh(){
    const t = userToken();
    if(!t) return;
    try{
      const me = await api("/api/user/me", { headers:{ "Authorization":"Bearer "+t } });
      document.getElementById("userDash").classList.remove("hidden");
      document.getElementById("userLoginBox").classList.add("hidden");
      document.getElementById("uCoin").textContent = formatNum(me.coin);
      document.getElementById("uLevel").textContent = me.level;
      document.getElementById("uXp").textContent = me.xp;
      document.getElementById("uBank").textContent = JSON.stringify(me.bank||{}, null, 2);
      document.getElementById("uInv").textContent = JSON.stringify(me.inventory||{}, null, 2);
      toast("âœ… Cáº­p nháº­t user");
    }catch(e){ toast("âš ï¸ KhÃ´ng láº¥y Ä‘Æ°á»£c data user"); }
  }

  function adminSession(){ return localStorage.getItem("ADMIN_SESSION") || ""; }
  function setAdminSession(s){
    localStorage.setItem("ADMIN_SESSION", s);
    document.getElementById("adminStatusTxt").textContent = s ? "âœ… logged" : "chÆ°a Ä‘Äƒng nháº­p";
  }
  function adminLogout(){
    setAdminSession("");
    document.getElementById("adminDash").classList.add("hidden");
    document.getElementById("adminLoginBox").classList.remove("hidden");
    toast("ğŸšª ÄÃ£ logout admin");
  }

  let lockAdminBtn=false;
  document.getElementById("adminLoginBtn").addEventListener("click", async ()=>{
    if(lockAdminBtn) return;
    lockAdminBtn=true; setTimeout(()=>lockAdminBtn=false,2500);
    const u = document.getElementById("adminUserInput").value.trim();
    const p = document.getElementById("adminPassInput").value;
    const msg = document.getElementById("adminLoginMsg");
    msg.textContent="â³ Äang Ä‘Äƒng nháº­p...";
    try{
      const d = await api("/api/admin/login", {method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify({username:u,password:p})});
      setAdminSession(d.session);
      msg.textContent="âœ… ÄÄƒng nháº­p admin thÃ nh cÃ´ng!";
      await adminRefresh();
    }catch(e){
      msg.textContent="âŒ Sai tÃ i khoáº£n/máº­t kháº©u hoáº·c API lá»—i.";
      toast("âŒ Admin login tháº¥t báº¡i");
    }
  });

  async function adminRefresh(){
    const s = adminSession();
    if(!s) return;
    try{
      const d = await api("/api/admin/overview", { headers:{ "X-Admin-Token": s } });
      document.getElementById("adminDash").classList.remove("hidden");
      document.getElementById("adminLoginBox").classList.add("hidden");
      document.getElementById("aUsers").textContent = d.users;
      document.getElementById("aClans").textContent = d.clans;
      document.getElementById("aGuilds").textContent = d.guilds;
      document.getElementById("aPend").textContent = d.pending_deposits;
      toast("âœ… Cáº­p nháº­t overview");
    }catch(e){ toast("âš ï¸ KhÃ´ng láº¥y overview admin"); }
  }

  async function adminLookup(){
    const s = adminSession();
    if(!s) return toast("âŒ ChÆ°a login admin");
    const uid = document.getElementById("lookupUid").value.trim();
    if(!uid) return;
    try{
      const d = await api("/api/admin/user/"+encodeURIComponent(uid), { headers:{ "X-Admin-Token": s } });
      document.getElementById("lookupResult").textContent = JSON.stringify(d.data, null, 2);
    }catch(e){ document.getElementById("lookupResult").textContent="âŒ KhÃ´ng tÃ¬m tháº¥y hoáº·c lá»—i API"; }
  }

  async function adminAddCoin(){
    const s = adminSession();
    if(!s) return toast("âŒ ChÆ°a login admin");
    const uid = document.getElementById("coinUid").value.trim();
    const delta = document.getElementById("coinDelta").value.trim();
    if(!uid || !delta) return toast("âŒ Thiáº¿u user_id hoáº·c delta");
    try{
      const d = await api("/api/admin/addcoin", {method:"POST", headers:{ "X-Admin-Token": s, "Content-Type":"application/json" }, body: JSON.stringify({user_id:Number(uid), delta:Number(delta)})});
      document.getElementById("coinMsg").textContent = "âœ… OK â€¢ Coin má»›i: " + formatNum(d.coin);
      toast("âœ… ÄÃ£ cáº­p nháº­t coin");
    }catch(e){
      document.getElementById("coinMsg").textContent = "âŒ Lá»—i cáº­p nháº­t coin";
      toast("âŒ AddCoin lá»—i");
    }
  }

  function logoutAll(){ userLogout(); adminLogout(); }
  function toast(txt){
    const el = document.createElement("div");
    el.className = "fixed bottom-5 left-1/2 -translate-x-1/2 glass rounded-2xl px-4 py-2 text-sm soft z-[60]";
    el.textContent = txt;
    document.body.appendChild(el);
    setTimeout(()=>el.remove(), 2200);
  }
  function formatNum(n){ try{ return Number(n).toLocaleString("vi-VN"); }catch(e){ return n; } }

  renderCommands();
  setApiBase(getApiBase());
  setUserToken(userToken());
  setAdminSession(adminSession());
  if(userToken()) userRefresh();
  if(adminSession()) adminRefresh();
</script>
</body>
</html>
