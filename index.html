<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tuáº¥n Ank Bot â€¢ VIP Control Panel</title>
  <meta name="description" content="Báº£ng Ä‘iá»u khiá»ƒn VIP cho Tuáº¥n Ank Bot â€“ káº¿t ná»‘i Web API, quáº£n lÃ½ Admin & User, shortener, thÃ´ng bÃ¡o, vÃ  há»‡ thá»‘ng bot." />
  <style>
    :root{
      --bg0:#070914;
      --bg1:#0b1026;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.10);
      --text:#e8ecff;
      --muted:rgba(232,236,255,.72);
      --muted2:rgba(232,236,255,.55);
      --good:#4cffb5;
      --warn:#ffcc66;
      --bad:#ff5c86;
      --brand1:#7c4dff;
      --brand2:#25f0d5;
      --shadow: 0 12px 44px rgba(0,0,0,.45);
      --radius:20px;
      --radius2:26px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 12% 8%, rgba(124,77,255,.24), transparent 55%),
        radial-gradient(900px 600px at 88% 18%, rgba(37,240,213,.20), transparent 55%),
        radial-gradient(800px 500px at 55% 92%, rgba(255,92,134,.14), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* Soft noise overlay */
    .noise{
      pointer-events:none;
      position:fixed; inset:0;
      opacity:.10;
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="220" height="220"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency=".8" numOctaves="3" stitchTiles="stitch"/></filter><rect width="220" height="220" filter="url(%23n)" opacity=".55"/></svg>');
      mix-blend-mode: overlay;
      z-index:1;
    }

    .wrap{
      position:relative;
      z-index:2;
      min-height:100%;
      display:grid;
      grid-template-columns: 300px 1fr;
      gap:18px;
      padding:18px;
      max-width: 1320px;
      margin:0 auto;
    }
    @media (max-width: 980px){
      .wrap{grid-template-columns:1fr; padding:14px}
    }

    .sidebar{
      position:sticky;
      top:16px;
      align-self:start;
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      backdrop-filter: blur(10px);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .sideTop{
      padding:18px 18px 12px 18px;
      border-bottom:1px solid var(--stroke);
    }
    .brandRow{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
    }
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: conic-gradient(from 220deg, var(--brand1), var(--brand2), var(--bad), var(--brand1));
      box-shadow: 0 10px 24px rgba(124,77,255,.28);
      position:relative;
    }
    .logo:after{
      content:"";
      position:absolute; inset:8px;
      background: rgba(0,0,0,.25);
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(8px);
    }
    .titleBox{display:flex; flex-direction:column; line-height:1.1}
    .titleBox .t1{font-weight:800; letter-spacing:.2px}
    .titleBox .t2{font-size:12px; color:var(--muted2)}
    .badgeVip{
      font-size:11px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(124,77,255,.18);
      color: rgba(232,236,255,.92);
      white-space:nowrap;
    }

    .sideStats{
      margin-top:12px;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .mini{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      border-radius:16px;
      padding:10px 12px;
    }
    .mini .k{font-size:11px;color:var(--muted2)}
    .mini .v{font-weight:800; margin-top:4px}

    .nav{
      padding:10px;
      display:flex; flex-direction:column;
      gap:8px;
    }
    .navBtn{
      cursor:pointer;
      border:1px solid transparent;
      background: rgba(255,255,255,.04);
      color:var(--text);
      padding:12px 12px;
      border-radius:16px;
      display:flex; align-items:center; gap:10px;
      transition:.18s ease;
    }
    .navBtn:hover{ background: rgba(255,255,255,.07); transform: translateY(-1px); }
    .navBtn.active{
      border-color: rgba(124,77,255,.42);
      background: linear-gradient(90deg, rgba(124,77,255,.26), rgba(37,240,213,.10));
      box-shadow: 0 10px 26px rgba(124,77,255,.18);
    }
    .ico{
      width:34px; height:34px; border-radius:14px;
      display:grid; place-items:center;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.22);
      font-size:16px;
    }
    .navBtn .text{display:flex; flex-direction:column}
    .navBtn .text b{font-size:13px}
    .navBtn .text span{font-size:11px;color:var(--muted2)}
    .sideBottom{
      padding:14px 18px 18px 18px;
      border-top:1px solid var(--stroke);
      color:var(--muted2);
      font-size:12px;
      line-height:1.35;
    }
    .linkLine{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .pillLink{
      text-decoration:none; color:var(--text);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      transition:.15s ease;
    }
    .pillLink:hover{transform: translateY(-1px); background: rgba(255,255,255,.07);}

    .main{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      backdrop-filter: blur(10px);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding:16px 18px;
      border-bottom:1px solid var(--stroke);
      gap:12px;
    }
    .crumb{
      display:flex; flex-direction:column;
      gap:3px;
    }
    .crumb .h1{font-weight:900; font-size:16px}
    .crumb .h2{font-size:12px;color:var(--muted2)}
    .actions{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end}
    .btn{
      cursor:pointer;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color:var(--text);
      padding:10px 12px;
      border-radius:16px;
      font-weight:700;
      font-size:12px;
      transition:.16s ease;
      display:flex; align-items:center; gap:8px;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.08)}
    .btn.primary{
      border-color: rgba(124,77,255,.55);
      background: linear-gradient(90deg, rgba(124,77,255,.34), rgba(37,240,213,.12));
    }
    .btn.danger{
      border-color: rgba(255,92,134,.55);
      background: rgba(255,92,134,.12);
    }
    .btn.good{
      border-color: rgba(76,255,181,.50);
      background: rgba(76,255,181,.10);
    }

    .content{
      padding:18px;
      display:grid;
      gap:14px;
    }
    .grid2{display:grid; grid-template-columns: 1fr 1fr; gap:14px}
    .grid3{display:grid; grid-template-columns: 1fr 1fr 1fr; gap:14px}
    @media (max-width: 980px){
      .grid2,.grid3{grid-template-columns:1fr}
    }

    .card{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      border-radius: var(--radius);
      padding:14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.28);
    }
    .card h3{
      margin:0;
      font-size:13px;
      letter-spacing:.2px;
    }
    .sub{font-size:12px;color:var(--muted2); margin-top:6px; line-height:1.35}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .field{
      width:100%;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.25);
      color: var(--text);
      padding:12px 12px;
      border-radius:16px;
      outline:none;
      font-size:13px;
    }
    .field::placeholder{color: rgba(232,236,255,.45)}
    .mono{font-family:var(--mono)}
    .kpi{
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:12px;
    }
    .kpi .big{
      font-size:24px;
      font-weight:900;
      letter-spacing:.2px;
      margin-top:2px;
    }
    .tag{
      font-size:11px;
      border:1px solid var(--stroke);
      padding:6px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.04);
      color: var(--muted);
    }

    .table{
      width:100%;
      border-collapse:separate;
      border-spacing:0 10px;
      font-size:13px;
    }
    .table th{
      text-align:left;
      color: var(--muted2);
      font-size:11px;
      font-weight:700;
      padding:0 10px 6px 10px;
    }
    .table td{
      padding:12px 10px;
      background: rgba(255,255,255,.035);
      border-top:1px solid rgba(255,255,255,.06);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .table tr td:first-child{border-left:1px solid rgba(255,255,255,.06); border-top-left-radius:16px; border-bottom-left-radius:16px}
    .table tr td:last-child{border-right:1px solid rgba(255,255,255,.06); border-top-right-radius:16px; border-bottom-right-radius:16px}
    .muted{color:var(--muted2)}
    .good{color:var(--good)}
    .bad{color:var(--bad)}
    .warn{color:var(--warn)}

    .toast{
      position:fixed;
      right:16px; bottom:16px;
      z-index:9999;
      max-width:min(520px, calc(100vw - 32px));
      border:1px solid var(--stroke);
      background: rgba(10,14,33,.85);
      backdrop-filter: blur(14px);
      border-radius: 18px;
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
      padding:12px 14px;
      display:none;
    }
    .toast.show{display:block; animation: pop .18s ease}
    @keyframes pop{from{transform: translateY(8px); opacity:.0}to{transform: translateY(0); opacity:1}}
    .toast b{display:block; font-size:12px}
    .toast span{display:block; font-size:12px; color:var(--muted2); margin-top:3px; line-height:1.35}

    .codeBox{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.35);
      border-radius:16px;
      padding:12px;
      font-family:var(--mono);
      font-size:12px;
      color: rgba(232,236,255,.88);
      overflow:auto;
    }
    .sep{height:1px; background: rgba(255,255,255,.08); margin:10px 0}

    .hide{display:none !important;}
    .right{margin-left:auto;}
  </style>
</head>
<body>
  <div class="noise"></div>

  <div class="wrap">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sideTop">
        <div class="brandRow">
          <div style="display:flex;align-items:center;gap:12px">
            <div class="logo"></div>
            <div class="titleBox">
              <div class="t1">Tuáº¥n Ank Bot</div>
              <div class="t2">VIP Control Panel â€¢ Netlify</div>
            </div>
          </div>
          <div class="badgeVip">VIP â€¢ ULTIMATE</div>
        </div>

        <div class="sideStats">
          <div class="mini">
            <div class="k">API Health</div>
            <div class="v" id="miniHealth">â€”</div>
          </div>
          <div class="mini">
            <div class="k">Tráº¡ng thÃ¡i</div>
            <div class="v" id="miniConn">ChÆ°a</div>
          </div>
        </div>
      </div>

      <div class="nav">
        <button class="navBtn active" data-page="home">
          <div class="ico">ğŸ </div>
          <div class="text"><b>Trang chá»§</b><span>Check API, hÆ°á»›ng dáº«n VIP</span></div>
        </button>
        <button class="navBtn" data-page="user">
          <div class="ico">ğŸ‘¤</div>
          <div class="text"><b>User</b><span>VÃ­ coin, level, token</span></div>
        </button>
        <button class="navBtn" data-page="admin">
          <div class="ico">ğŸ›¡ï¸</div>
          <div class="text"><b>Admin</b><span>Quáº£n lÃ½ bot & há»‡ thá»‘ng</span></div>
        </button>
        <button class="navBtn" data-page="shorteners">
          <div class="ico">ğŸ”—</div>
          <div class="text"><b>Link vÆ°á»£t</b><span>ThÃªm / xÃ³a API rÃºt gá»n</span></div>
        </button>
        <button class="navBtn" data-page="announce">
          <div class="ico">ğŸ“£</div>
          <div class="text"><b>ThÃ´ng bÃ¡o</b><span>Set kÃªnh + gá»­i broadcast</span></div>
        </button>
        <button class="navBtn" data-page="cmd">
          <div class="ico">ğŸ“¦</div>
          <div class="text"><b>Lá»‡nh trong bot</b><span>Danh má»¥c & mÃ´ táº£ VIP</span></div>
        </button>
      </div>

      <div class="sideBottom">
        <b>ğŸ’¡ Tip VIP</b><br/>
        Náº¿u Netlify bÃ¡o <span class="bad">KhÃ´ng káº¿t ná»‘i</span> â†’ hÃ£y Ä‘áº£m báº£o bot-hosting Ä‘ang má»Ÿ Ä‘Ãºng PORT (Allocations) vÃ  Web API cháº¡y Ä‘Ãºng port Ä‘Ã³.
        <div class="linkLine">
          <a class="pillLink" href="https://facebook.com/anhyeuemnhamlun" target="_blank" rel="noreferrer">Facebook</a>
          <a class="pillLink" href="https://zalo.me/0763465951" target="_blank" rel="noreferrer">Zalo</a>
          <a class="pillLink" href="https://t.me/tuanank209" target="_blank" rel="noreferrer">Telegram</a>
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="topbar">
        <div class="crumb">
          <div class="h1" id="pageTitle">Trang chá»§</div>
          <div class="h2" id="pageSub">Káº¿t ná»‘i Web API & Ä‘iá»u khiá»ƒn bot VIP</div>
        </div>
        <div class="actions">
          <button class="btn" id="btnCheckApi">ğŸ”Œ Check API</button>
          <button class="btn primary" id="btnSaveApi">ğŸ’¾ LÆ°u API Base</button>
          <button class="btn danger" id="btnLogoutAll">ğŸšª Logout</button>
        </div>
      </div>

      <div class="content">
        <!-- HOME -->
        <section id="page-home">
          <div class="grid2">
            <div class="card">
              <h3>ğŸ”— API Base</h3>
              <div class="sub">DÃ¡n API Base (domain bot-hosting cloud) cá»§a báº¡n vÃ o Ä‘Ã¢y. Web sáº½ tá»± sá»­a lá»—i dÃ­nh chá»¯ â€œBaseâ€ hoáº·c khoáº£ng tráº¯ng.</div>
              <div class="sep"></div>
              <input class="field mono" id="apiBaseInput" placeholder="https://xxxx.site.bot-hosting.cloud" />
              <div class="row" style="margin-top:10px">
                <button class="btn primary" id="btnHealth">âœ… API Health</button>
                <button class="btn" id="btnOpenHealth">ğŸŒ Má»Ÿ /api/health</button>
              </div>
              <div class="sub" style="margin-top:10px">
                <span class="muted">Gá»£i Ã½:</span> Náº¿u bot-hosting cáº¥p Allocation port lÃ  <b>20781</b>, thÃ¬ Web API pháº£i cháº¡y Ä‘Ãºng <b>20781</b> (khÃ´ng pháº£i 8080).
              </div>
            </div>

            <div class="card">
              <h3>âš¡ Tráº¡ng thÃ¡i káº¿t ná»‘i</h3>
              <div class="sub">Web nÃ y chá»‰ lÃ  Front-end (Netlify). Bot cá»§a báº¡n pháº£i cháº¡y Web API má»›i quáº£n lÃ½ Ä‘Æ°á»£c.</div>
              <div class="sep"></div>

              <table class="table">
                <thead><tr><th>Má»¥c</th><th>Tráº¡ng thÃ¡i</th></tr></thead>
                <tbody>
                  <tr><td>API Health</td><td id="healthTxt" class="muted">â€”</td></tr>
                  <tr><td>User</td><td id="userState" class="muted">chÆ°a Ä‘Äƒng nháº­p</td></tr>
                  <tr><td>Admin</td><td id="adminState" class="muted">chÆ°a Ä‘Äƒng nháº­p</td></tr>
                </tbody>
              </table>

              <div class="sub" style="margin-top:10px">
                âœ… Náº¿u <b>API Health OK</b> thÃ¬ báº¡n cÃ³ thá»ƒ login User/Admin vÃ  quáº£n lÃ½ full há»‡ thá»‘ng.
              </div>
            </div>
          </div>

          <div class="card">
            <h3>âœ¨ VIP Features</h3>
            <div class="sub">
              â€¢ Login User báº±ng <b>token 30 kÃ½ tá»±</b> (láº¥y báº±ng lá»‡nh <span class="mono">/token</span> trong Discord).<br/>
              â€¢ Login Admin báº±ng <b>tÃ i khoáº£n/máº­t kháº©u </b> Ä‘á»ƒ quáº£n trá»‹ há»‡ thá»‘ng bot.<br/>
              â€¢ Quáº£n lÃ½ há»‡ thá»‘ng vÆ°á»£t link, gá»­i thÃ´ng bÃ¡o, add coin, band/unbandâ€¦ táº¥t cáº£ 1 cháº¡m.
            </div>
          </div>
        </section>

        <!-- USER -->
        <section id="page-user" class="hide">
          <div class="grid2">
            <div class="card">
              <h3>ğŸ‘¤ User Login</h3>
              <div class="sub">DÃ¡n token cá»§a báº¡n (bot sáº½ gá»­i token qua tin nháº¯n riÃªng khi báº¡n dÃ¹ng <span class="mono">/token</span>).</div>
              <div class="sep"></div>
              <input class="field mono" id="userTokenInput" placeholder="USER_TOKEN (30 kÃ½ tá»±)" />
              <div class="row" style="margin-top:10px">
                <button class="btn primary" id="btnUserLogin">ğŸ” ÄÄƒng nháº­p</button>
                <button class="btn" id="btnUserFetch">ğŸ“¥ Láº¥y thÃ´ng tin</button>
                <button class="btn danger" id="btnUserLogout">ğŸšª Logout User</button>
              </div>
              <div class="sub" style="margin-top:10px">
                Tip: Náº¿u báº¡n quÃªn token â†’ vÃ o Discord dÃ¹ng <span class="mono">/token reset</span> Ä‘á»ƒ reset token má»›i.
              </div>
            </div>

            <div class="card">
              <h3>ğŸ’° VÃ­ & Level</h3>
              <div class="sub">ThÃ´ng tin nÃ y láº¥y tá»« API: <span class="mono">GET /api/user/me</span></div>
              <div class="sep"></div>
              <div class="grid3">
                <div class="mini">
                  <div class="k">Coin</div>
                  <div class="v" id="uCoin">â€”</div>
                </div>
                <div class="mini">
                  <div class="k">Level</div>
                  <div class="v" id="uLevel">â€”</div>
                </div>
                <div class="mini">
                  <div class="k">XP</div>
                  <div class="v" id="uXp">â€”</div>
                </div>
              </div>
              <div class="sep"></div>
              <div class="row">
                <button class="btn good" id="btnResetToken">â™»ï¸ Reset Token (API)</button>
                <button class="btn" id="btnCopyToken">ğŸ“‹ Copy token</button>
                <span class="tag" id="tokenTag">token: â€”</span>
              </div>
              <div class="sub" style="margin-top:10px">
                Reset token API cÃ³ rate limit Ä‘á»ƒ chá»‘ng spam.
              </div>
            </div>
          </div>

          <div class="card">
            <h3>ğŸ¦ Bank & Inventory</h3>
            <div class="sub">Xem thÃ´ng tin ngÃ¢n hÃ ng áº£o + váº­t pháº©m Ä‘ang sá»Ÿ há»¯u.</div>
            <div class="sep"></div>
            <div class="grid2">
              <div>
                <div class="sub"><b>Bank</b></div>
                <pre class="codeBox" id="uBank">{}</pre>
              </div>
              <div>
                <div class="sub"><b>Inventory</b></div>
                <pre class="codeBox" id="uInv">{}</pre>
              </div>
            </div>
          </div>
        </section>

        <!-- ADMIN -->
        <section id="page-admin" class="hide">
          <div class="grid2">
            <div class="card">
              <h3>ğŸ›¡ï¸ Admin Login</h3>
              <div class="sub">TÃ i khoáº£n máº·c Ä‘á»‹nh: <span class="mono">admin / tuananh2009</span></div>
              <div class="sep"></div>
              <input class="field" id="adminUser" placeholder="Username" value="admin" />
              <input class="field" id="adminPass" placeholder="Password" type="password" value="tuananh2009" style="margin-top:10px"/>
              <div class="row" style="margin-top:10px">
                <button class="btn primary" id="btnAdminLogin">ğŸ” ÄÄƒng nháº­p Admin</button>
                <button class="btn" id="btnAdminOverview">ğŸ“Š Overview</button>
                <button class="btn danger" id="btnAdminLogout">ğŸšª Logout Admin</button>
              </div>
              <div class="sub" style="margin-top:10px">
                Admin session dÃ¹ng header <span class="mono">X-Admin-Token</span>.
              </div>
            </div>

            <div class="card">
              <h3>ğŸ“Š Tá»•ng quan há»‡ thá»‘ng</h3>
              <div class="sub">API: <span class="mono">GET /api/admin/overview</span></div>
              <div class="sep"></div>
              <div class="grid3">
                <div class="mini"><div class="k">Users</div><div class="v" id="ovUsers">â€”</div></div>
                <div class="mini"><div class="k">Clans</div><div class="v" id="ovClans">â€”</div></div>
                <div class="mini"><div class="k">Guilds</div><div class="v" id="ovGuilds">â€”</div></div>
              </div>
              <div class="sep"></div>
              <div class="sub">Pending deposits</div>
              <pre class="codeBox" id="ovPend">[]</pre>
            </div>
          </div>

          <div class="grid2">
            <div class="card">
              <h3>ğŸ” Tra user theo ID</h3>
              <div class="sub">API: <span class="mono">GET /api/admin/user/{uid}</span></div>
              <div class="sep"></div>
              <input class="field mono" id="lookupUid" placeholder="Nháº­p UID Discord (vd: 1358505048904302724)" />
              <div class="row" style="margin-top:10px">
                <button class="btn primary" id="btnLookup">ğŸ” Lookup</button>
                <button class="btn" id="btnCopyUserJson">ğŸ“‹ Copy JSON</button>
              </div>
              <div class="sep"></div>
              <pre class="codeBox" id="lookupOut">{}</pre>
            </div>

            <div class="card">
              <h3>ğŸ’¸ Add coin / Buff coin</h3>
              <div class="sub">API: <span class="mono">POST /api/admin/addcoin</span></div>
              <div class="sep"></div>
              <input class="field mono" id="addUid" placeholder="UID" />
              <input class="field mono" id="addAmount" placeholder="Sá»‘ coin (vd: 50000)" style="margin-top:10px" />
              <div class="row" style="margin-top:10px">
                <button class="btn good" id="btnAddCoin">â• Add coin</button>
                <span class="tag">Unlimited (VIP)</span>
              </div>
              <div class="sub" style="margin-top:10px">
                LÆ°u Ã½: Buff coin lÃ  quyá»n Admin. User thÆ°á»ng khÃ´ng dÃ¹ng Ä‘Æ°á»£c.
              </div>
            </div>
          </div>

          <div class="grid2">
            <div class="card">
              <h3>â›” Band / Unband</h3>
              <div class="sub">Band user Ä‘á»ƒ khÃ´ng dÃ¹ng bot (theo thá»i gian).</div>
              <div class="sep"></div>
              <input class="field mono" id="bandUid" placeholder="UID" />
              <input class="field mono" id="bandMinutes" placeholder="PhÃºt band (vd: 60)" style="margin-top:10px" />
              <div class="row" style="margin-top:10px">
                <button class="btn danger" id="btnBand">ğŸ”’ Band</button>
                <button class="btn" id="btnListBand">ğŸ“ƒ Danh sÃ¡ch band</button>
                <button class="btn good" id="btnUnband">ğŸ”“ Unband</button>
              </div>
              <div class="sep"></div>
              <pre class="codeBox" id="bandOut">[]</pre>
            </div>

            <div class="card">
              <h3>ğŸ§  Gá»£i Ã½ váº­n hÃ nh VIP</h3>
              <div class="sub">
                â€¢ Náº¿u Web API OK nhÆ°ng netlify khÃ´ng gá»i Ä‘Æ°á»£c â†’ kiá»ƒm tra CORS hoáº·c API Base sai.<br/>
                â€¢ Náº¿u domain cloud 502 â†’ Web API cháº¡y sai PORT allocation.<br/>
                â€¢ Äá»«ng share token user ra ngoÃ i (báº£o máº­t vÃ­ coin).<br/>
                â€¢ Clan VIP: chiáº¿n clan + shop clan cháº¡y trong Discord, Admin chá»‰ quáº£n lÃ½ há»‡ thá»‘ng tá»•ng.
              </div>
              <div class="sep"></div>
              <div class="row">
                <a class="btn" href="https://discord.com/developers/applications" target="_blank" rel="noreferrer">ğŸ§© Discord Dev</a>
                <a class="btn" href="https://bot-hosting.net" target="_blank" rel="noreferrer">â˜ï¸ Bot-hosting</a>
              </div>
            </div>
          </div>
        </section>

        <!-- SHORTENERS -->
        <section id="page-shorteners" class="hide">
          <div class="card">
            <h3>ğŸ”— Quáº£n lÃ½ Link VÆ°á»£t (Shorteners)</h3>
            <div class="sub">ThÃªm / xÃ³a danh sÃ¡ch API rÃºt gá»n Ä‘ang dÃ¹ng cho /getkey. (Admin only)</div>
            <div class="sep"></div>

            <div class="row">
              <button class="btn primary" id="btnLoadShort">ğŸ“¥ Load</button>
              <button class="btn good" id="btnSaveShort">ğŸ’¾ Save</button>
              <button class="btn" id="btnAddShort">â• Add dÃ²ng</button>
              <button class="btn danger" id="btnClearShort">ğŸ§¹ Clear</button>
              <span class="tag">Tá»‘i Ä‘a 50 API</span>
            </div>

            <div class="sep"></div>
            <div class="sub">Format: má»—i dÃ²ng 1 shortener, gá»“m <b>name</b> vÃ  <b>api</b> (url API shorten).</div>
            <div class="sep"></div>

            <table class="table" id="shortTable">
              <thead>
                <tr><th>#</th><th>Name</th><th>API</th><th></th></tr>
              </thead>
              <tbody></tbody>
            </table>

            <div class="sub">Sau khi Save, bot sáº½ dÃ¹ng list má»›i cho menu /getkey.</div>
          </div>
        </section>

        <!-- ANNOUNCE -->
        <section id="page-announce" class="hide">
          <div class="grid2">
            <div class="card">
              <h3>ğŸ“Œ Set kÃªnh thÃ´ng bÃ¡o</h3>
              <div class="sub">API: <span class="mono">POST /api/admin/announce_channel</span></div>
              <div class="sep"></div>
              <input class="field mono" id="announceChannel" placeholder="Channel ID (vd: 123456789012345678)" />
              <div class="row" style="margin-top:10px">
                <button class="btn primary" id="btnSetChannel">âœ… LÆ°u kÃªnh</button>
              </div>
              <div class="sub" style="margin-top:10px">
                Chá»‰ 1 kÃªnh thÃ´ng bÃ¡o cho toÃ n bot. Báº¡n cÃ³ thá»ƒ Ä‘á»•i láº¡i báº¥t ká»³ lÃºc nÃ o.
              </div>
            </div>

            <div class="card">
              <h3>ğŸ“£ Gá»­i thÃ´ng bÃ¡o</h3>
              <div class="sub">API: <span class="mono">POST /api/admin/announce</span></div>
              <div class="sep"></div>
              <textarea class="field" id="announceText" rows="6" placeholder="Nháº­p ná»™i dung broadcast..."></textarea>
              <div class="row" style="margin-top:10px">
                <button class="btn good" id="btnSendAnn">ğŸš€ Gá»­i ngay</button>
              </div>
              <div class="sub" style="margin-top:10px">
                Gá»£i Ã½: báº¡n cÃ³ thá»ƒ dÃ¹ng markdown Ä‘Æ¡n giáº£n Ä‘á»ƒ Ä‘áº¹p hÆ¡n.
              </div>
            </div>
          </div>

          <div class="card">
            <h3>ğŸ§¾ Káº¿t quáº£</h3>
            <div class="sub">Log káº¿t quáº£ thao tÃ¡c thÃ´ng bÃ¡o.</div>
            <div class="sep"></div>
            <pre class="codeBox" id="announceOut">{}</pre>
          </div>
        </section>

        <!-- CMD -->
        <section id="page-cmd" class="hide">
          <div class="card">
            <h3>ğŸ“¦ Danh má»¥c lá»‡nh (VIP Edition)</h3>
            <div class="sub">ÄÃ¢y lÃ  â€œbáº£n giá»›i thiá»‡uâ€ Ä‘á»ƒ báº¡n copy vÃ o giá»›i thiá»‡u server hoáº·c menu bot. (KhÃ´ng áº£nh hÆ°á»Ÿng sá»‘ slash command).</div>
            <div class="sep"></div>
            <div class="grid2">
              <div class="card" style="margin:0">
                <h3>ğŸ® Giáº£i trÃ­ & cÆ°á»£c</h3>
                <div class="sub">
                  <span class="mono">/777</span> â€¢ <span class="mono">/taixiu</span> â€¢ <span class="mono">/nohu</span> â€¢ <span class="mono">/loto</span> â€¢ <span class="mono">/coinflip</span><br/>
                  <span class="mono">/noitu</span> (ná»‘i tá»«) â€¢ <span class="mono">/anhgai</span> â€¢ <span class="mono">/anhtrai</span>
                </div>
              </div>
              <div class="card" style="margin:0">
                <h3>ğŸ’° Coin & ngÃ¢n hÃ ng</h3>
                <div class="sub">
                  <span class="mono">/napcoin</span> â€¢ <span class="mono">/xemcoin</span> â€¢ <span class="mono">/nganhang</span><br/>
                  LÃ£i bank 5%/giá», chuyá»ƒn tiá»n, náº¡p coin vÃ o bank.
                </div>
              </div>
              <div class="card" style="margin:0">
                <h3>ğŸ”‘ Link vÆ°á»£t & nháº­n thÆ°á»Ÿng</h3>
                <div class="sub">
                  <span class="mono">/getkey</span> (chá»‰ hiá»‡n link vÆ°á»£t) â€¢ <span class="mono">/nhapkey</span> nháº­n coin random + daily bonus.
                </div>
              </div>
              <div class="card" style="margin:0">
                <h3>ğŸ§© Clan VIP</h3>
                <div class="sub">
                  <span class="mono">/clan</span> (Táº¡o/Xem/CÃ y/NÃ¢ng)<br/>
                  VIP: Quá»¹ clan â€¢ Shop clan â€¢ Chiáº¿n clan â€¢ Perk clan.
                </div>
              </div>
              <div class="card" style="margin:0">
                <h3>ğŸ“ˆ Top & Event</h3>
                <div class="sub">
                  <span class="mono">/top</span> Top coin â€¢ Top vÆ°á»£t link â€¢ Top clan (reset tuáº§n).
                </div>
              </div>
              <div class="card" style="margin:0">
                <h3>ğŸ›’ Shop item</h3>
                <div class="sub">
                  <span class="mono">/shop</span> Thuá»‘c may máº¯n â€¢ Báº£o vá»‡ coin â€¢ nhiá»u váº­t pháº©m khÃ¡c (cÃ³ háº¡n dÃ¹ng).
                </div>
              </div>
              <div class="card" style="margin:0">
                <h3>ğŸ§° Admin tools</h3>
                <div class="sub">
                  <span class="mono">/thongbao</span> â€¢ <span class="mono">/lock</span> â€¢ <span class="mono">/band</span>/<span class="mono">/unband</span> â€¢ <span class="mono">/buffcoin</span> â€¢ <span class="mono">/buffwin</span> â€¢ <span class="mono">/buffclan</span>
                </div>
              </div>
            </div>

            <div class="sep"></div>
            <div class="sub">
              ğŸ“Œ <b>Note:</b> Discord giá»›i háº¡n 100 slash command global. Bot VIP sáº½ dÃ¹ng menu & button Ä‘á»ƒ gom nhÃ³m, khÃ´ng báº¯n quÃ¡ giá»›i háº¡n.
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <div class="toast" id="toast">
    <b id="toastTitle">ThÃ´ng bÃ¡o</b>
    <span id="toastMsg">â€”</span>
  </div>

<script>
  // ===== Storage =====
  const LS = {
    apiBase: "vip_api_base",
    userToken: "vip_user_token",
    adminToken: "vip_admin_token"
  };

  const $ = (id)=>document.getElementById(id);
  const toastEl = $("toast");
  const toastTitle = $("toastTitle");
  const toastMsg = $("toastMsg");

  function showToast(title, msg){
    toastTitle.textContent = title || "ThÃ´ng bÃ¡o";
    toastMsg.textContent = msg || "";
    toastEl.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=>toastEl.classList.remove("show"), 3500);
  }

  function normalizeApiBase(v){
    v = (v||"").trim();
    v = v.replace(/\s+/g,"");
    // Fix case: ...-a971-Base1da3... when UI wraps
    v = v.replace(/-Base(?=[0-9a-fA-F]{4})/,"-");
    v = v.replace(/\/+$/,"");
    return v;
  }

  function getApiBase(){
    return normalizeApiBase(localStorage.getItem(LS.apiBase) || $("apiBaseInput").value || "");
  }

  function setApiBase(v){
    v = normalizeApiBase(v);
    localStorage.setItem(LS.apiBase, v);
    $("apiBaseInput").value = v;
  }

  function getUserToken(){ return (localStorage.getItem(LS.userToken)||"").trim(); }
  function setUserToken(t){ localStorage.setItem(LS.userToken, (t||"").trim()); }
  function getAdminToken(){ return (localStorage.getItem(LS.adminToken)||"").trim(); }
  function setAdminToken(t){ localStorage.setItem(LS.adminToken, (t||"").trim()); }

  // ===== API helper with timeout =====
  async function api(path, {method="GET", body=null, auth=null, admin=null}={}){
    const base = getApiBase();
    if(!base) throw new Error("NO_API_BASE");
    const url = base + path;

    const headers = {"Content-Type":"application/json"};
    if(auth) headers["Authorization"] = "Bearer " + auth;
    if(admin) headers["X-Admin-Token"] = admin;

    const controller = new AbortController();
    const t = setTimeout(()=>controller.abort(), 9000);

    const res = await fetch(url, {
      method,
      headers,
      body: body ? JSON.stringify(body) : undefined,
      mode: "cors",
      signal: controller.signal
    }).catch(e=>{
      clearTimeout(t);
      throw e;
    });

    clearTimeout(t);

    let data = null;
    try{ data = await res.json(); }catch(e){ data = null; }

    if(!res.ok){
      const err = (data && (data.error || data.message)) ? (data.error||data.message) : ("HTTP_" + res.status);
      const ex = new Error(err);
      ex.status = res.status;
      ex.data = data;
      throw ex;
    }
    return data;
  }

  // ===== UI pages =====
  const pages = ["home","user","admin","shorteners","announce","cmd"];
  function switchPage(p){
    pages.forEach(x=>{
      const sec = document.querySelector("#page-" + x);
      if(sec) sec.classList.toggle("hide", x!==p);
      document.querySelectorAll(".navBtn").forEach(b=>{
        b.classList.toggle("active", b.dataset.page===p);
      });
    });

    const titleMap = {
      home:["Trang chá»§","Káº¿t ná»‘i Web API & Ä‘iá»u khiá»ƒn bot VIP"],
      user:["User","VÃ­ coin, level, token & inventory"],
      admin:["Admin","Quáº£n lÃ½ há»‡ thá»‘ng bot báº±ng Web API"],
      shorteners:["Link vÆ°á»£t","Quáº£n lÃ½ API rÃºt gá»n (Admin)"],
      announce:["ThÃ´ng bÃ¡o","Set kÃªnh + gá»­i broadcast"],
      cmd:["Lá»‡nh trong bot","Danh má»¥c lá»‡nh VIP Ä‘á»ƒ giá»›i thiá»‡u"]
    };
    const t = titleMap[p] || ["Panel","VIP Control Panel"];
    $("pageTitle").textContent = t[0];
    $("pageSub").textContent = t[1];

    location.hash = "#"+p;
  }

  // ===== Health =====
  async function checkHealth(){
    try{
      const d = await api("/api/health");
      $("healthTxt").textContent = d.ok ? "âœ… OK" : "âš ï¸ lá»—i";
      $("healthTxt").className = d.ok ? "good" : "warn";
      $("miniHealth").textContent = d.ok ? "OK" : "WARN";
      $("miniConn").textContent = d.ok ? "Sáºµn sÃ ng" : "ChÆ°a";
      showToast("âœ… API OK", "Káº¿t ná»‘i Web API thÃ nh cÃ´ng.");
      return true;
    }catch(e){
      $("healthTxt").textContent = "âŒ KhÃ´ng káº¿t ná»‘i";
      $("healthTxt").className = "bad";
      $("miniHealth").textContent = "OFF";
      $("miniConn").textContent = "ChÆ°a";
      if(String(e).includes("AbortError")){
        showToast("â±ï¸ Timeout", "Bot-hosting proxy chÆ°a trá» Ä‘Ãºng port hoáº·c API chÆ°a cháº¡y.");
      }else{
        showToast("âŒ API lá»—i", "Kiá»ƒm tra API Base + bot Ä‘Ã£ báº­t Web API Ä‘Ãºng PORT hosting.");
      }
      return false;
    }
  }

  // ===== User =====
  async function userLogin(){
    const token = $("userTokenInput").value.trim();
    if(!token) return showToast("Thiáº¿u token", "DÃ¡n token user (bot gá»­i qua DM).");
    try{
      await api("/api/user/login", {method:"POST", body:{token}});
      setUserToken(token);
      $("userState").textContent = "âœ… Ä‘Ã£ Ä‘Äƒng nháº­p";
      $("userState").className = "good";
      showToast("âœ… User login", "ÄÄƒng nháº­p thÃ nh cÃ´ng.");
      await userFetch();
    }catch(e){
      showToast("âŒ Login fail", e.message || "BAD_TOKEN");
    }
  }

  async function userFetch(){
    const token = getUserToken() || $("userTokenInput").value.trim();
    if(!token) return showToast("ChÆ°a cÃ³ token", "HÃ£y login user trÆ°á»›c.");
    try{
      const d = await api("/api/user/me", {auth: token});
      $("uCoin").textContent = String(d.coin ?? "â€”");
      $("uLevel").textContent = String(d.level ?? "â€”");
      $("uXp").textContent = String(d.xp ?? "â€”");
      $("uBank").textContent = JSON.stringify(d.bank ?? {}, null, 2);
      $("uInv").textContent = JSON.stringify(d.inventory ?? {}, null, 2);
      $("tokenTag").textContent = "token: " + token.slice(0,6) + "..." + token.slice(-6);
      showToast("ğŸ“¥ ÄÃ£ táº£i", "Cáº­p nháº­t thÃ´ng tin user.");
      $("userState").textContent = "âœ… Ä‘Ã£ Ä‘Äƒng nháº­p";
      $("userState").className = "good";
    }catch(e){
      showToast("âŒ Fetch fail", e.message || "UNAUTHORIZED");
    }
  }

  async function userResetToken(){
    const token = getUserToken();
    if(!token) return showToast("ChÆ°a login", "ÄÄƒng nháº­p user trÆ°á»›c.");
    try{
      const d = await api("/api/user/reset_token", {method:"POST", auth: token});
      if(d.token){
        setUserToken(d.token);
        $("userTokenInput").value = d.token;
        $("tokenTag").textContent = "token: " + d.token.slice(0,6) + "..." + d.token.slice(-6);
        showToast("â™»ï¸ Token má»›i", "ÄÃ£ reset token thÃ nh cÃ´ng. Copy token má»›i Ä‘á»ƒ dÃ¹ng.");
      }else{
        showToast("âš ï¸", "Reset token OK nhÆ°ng khÃ´ng tráº£ token.");
      }
    }catch(e){
      if(e.message==="RATE_LIMIT"){
        showToast("â›” Rate limit", "Báº¡n reset quÃ¡ nhanh. Thá»­ láº¡i sau.");
      }else{
        showToast("âŒ Reset fail", e.message || "UNAUTHORIZED");
      }
    }
  }

  function userLogout(){
    setUserToken("");
    $("userTokenInput").value = "";
    $("userState").textContent = "chÆ°a Ä‘Äƒng nháº­p";
    $("userState").className = "muted";
    $("uCoin").textContent = "â€”";
    $("uLevel").textContent = "â€”";
    $("uXp").textContent = "â€”";
    $("uBank").textContent = "{}";
    $("uInv").textContent = "{}";
    $("tokenTag").textContent = "token: â€”";
    showToast("ğŸ‘¤ Logout", "ÄÃ£ Ä‘Äƒng xuáº¥t User.");
  }

  // ===== Admin =====
  async function adminLogin(){
    const username = $("adminUser").value.trim();
    const password = $("adminPass").value.trim();
    try{
      const d = await api("/api/admin/login", {method:"POST", body:{username,password}});
      if(d.session){
        setAdminToken(d.session);
        $("adminState").textContent = "âœ… Ä‘Ã£ Ä‘Äƒng nháº­p";
        $("adminState").className = "good";
        showToast("ğŸ›¡ï¸ Admin OK", "ÄÄƒng nháº­p admin thÃ nh cÃ´ng.");
        await adminOverview();
      }else{
        showToast("âš ï¸", "Login OK nhÆ°ng khÃ´ng cÃ³ session.");
      }
    }catch(e){
      showToast("âŒ Admin fail", e.message || "BAD_CRED");
    }
  }

  async function adminOverview(){
    const sess = getAdminToken();
    if(!sess) return showToast("ChÆ°a login", "ÄÄƒng nháº­p Admin trÆ°á»›c.");
    try{
      const d = await api("/api/admin/overview", {admin: sess});
      $("ovUsers").textContent = String(d.users ?? "â€”");
      $("ovClans").textContent = String(d.clans ?? "â€”");
      $("ovGuilds").textContent = String(d.guilds ?? "â€”");
      $("ovPend").textContent = JSON.stringify(d.pending_deposits ?? [], null, 2);
      showToast("ğŸ“Š Overview", "ÄÃ£ cáº­p nháº­t tá»•ng quan.");
      $("adminState").textContent = "âœ… Ä‘Ã£ Ä‘Äƒng nháº­p";
      $("adminState").className = "good";
    }catch(e){
      showToast("âŒ Overview fail", e.message || "UNAUTHORIZED");
    }
  }

  function adminLogout(){
    setAdminToken("");
    $("adminState").textContent = "chÆ°a Ä‘Äƒng nháº­p";
    $("adminState").className = "muted";
    showToast("ğŸ›¡ï¸ Logout", "ÄÃ£ Ä‘Äƒng xuáº¥t Admin.");
  }

  async function adminLookup(){
    const sess = getAdminToken();
    const uid = Number(($("lookupUid").value||"").trim());
    if(!sess) return showToast("ChÆ°a login", "ÄÄƒng nháº­p Admin trÆ°á»›c.");
    if(!uid) return showToast("Thiáº¿u UID", "Nháº­p UID cáº§n tra.");
    try{
      const d = await api("/api/admin/user/" + uid, {admin: sess});
      $("lookupOut").textContent = JSON.stringify(d.data ?? {}, null, 2);
      showToast("ğŸ” Lookup OK", "ÄÃ£ táº£i dá»¯ liá»‡u user.");
    }catch(e){
      showToast("âŒ Lookup fail", e.message || "BAD_UID");
    }
  }

  async function adminAddCoin(){
    const sess = getAdminToken();
    if(!sess) return showToast("ChÆ°a login", "ÄÄƒng nháº­p Admin trÆ°á»›c.");
    const uid = Number(($("addUid").value||"").trim());
    const amount = Number(($("addAmount").value||"").trim());
    if(!uid || !amount) return showToast("Thiáº¿u dá»¯ liá»‡u", "Nháº­p UID vÃ  sá»‘ coin.");
    try{
      const d = await api("/api/admin/addcoin", {method:"POST", admin:sess, body:{uid, amount}});
      showToast("âœ… Add coin", "ÄÃ£ cá»™ng coin thÃ nh cÃ´ng.");
    }catch(e){
      showToast("âŒ Add fail", e.message || "UNAUTHORIZED");
    }
  }

  async function adminBand(){
    const sess = getAdminToken();
    if(!sess) return showToast("ChÆ°a login", "ÄÄƒng nháº­p Admin trÆ°á»›c.");
    const uid = Number(($("bandUid").value||"").trim());
    const minutes = Number(($("bandMinutes").value||"").trim());
    if(!uid || !minutes) return showToast("Thiáº¿u dá»¯ liá»‡u", "Nháº­p UID vÃ  phÃºt band.");
    try{
      const d = await api("/api/admin/band", {method:"POST", admin:sess, body:{uid, minutes}});
      showToast("ğŸ”’ Band", "ÄÃ£ band user.");
      await adminBandList();
    }catch(e){
      showToast("âŒ Band fail", e.message || "UNAUTHORIZED");
    }
  }

  async function adminBandList(){
    const sess = getAdminToken();
    if(!sess) return showToast("ChÆ°a login", "ÄÄƒng nháº­p Admin trÆ°á»›c.");
    try{
      const d = await api("/api/admin/bands", {admin:sess});
      $("bandOut").textContent = JSON.stringify(d.items ?? [], null, 2);
      showToast("ğŸ“ƒ Band list", "ÄÃ£ cáº­p nháº­t danh sÃ¡ch.");
    }catch(e){
      showToast("âŒ List fail", e.message || "UNAUTHORIZED");
    }
  }

  async function adminUnband(){
    const sess = getAdminToken();
    if(!sess) return showToast("ChÆ°a login", "ÄÄƒng nháº­p Admin trÆ°á»›c.");
    const uid = Number(($("bandUid").value||"").trim());
    if(!uid) return showToast("Thiáº¿u UID", "Nháº­p UID Ä‘á»ƒ unband.");
    try{
      const d = await api("/api/admin/unband", {method:"POST", admin:sess, body:{uid}});
      showToast("ğŸ”“ Unband", "ÄÃ£ unband user.");
      await adminBandList();
    }catch(e){
      showToast("âŒ Unband fail", e.message || "UNAUTHORIZED");
    }
  }

  // ===== Shorteners =====
  function shortRow(i, item){
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="muted">${i+1}</td>
      <td><input class="field" data-k="name" value="${escapeHtml(item?.name||"")}" placeholder="Name (vd: LINK4M)" /></td>
      <td><input class="field mono" data-k="api" value="${escapeHtml(item?.api||"")}" placeholder="https://...&url=" /></td>
      <td style="width:64px"><button class="btn danger" style="padding:10px 12px" data-act="del">ğŸ—‘ï¸</button></td>
    `;
    tr.querySelector('[data-act="del"]').onclick = ()=>{
      tr.remove();
      renumberShort();
    };
    return tr;
  }

  function renumberShort(){
    const tb = $("shortTable").querySelector("tbody");
    [...tb.querySelectorAll("tr")].forEach((tr, idx)=>{
      tr.children[0].textContent = String(idx+1);
    });
  }

  function getShortItems(){
    const tb = $("shortTable").querySelector("tbody");
    const out = [];
    [...tb.querySelectorAll("tr")].forEach(tr=>{
      const name = tr.querySelector('input[data-k="name"]').value.trim();
      const apiUrl = tr.querySelector('input[data-k="api"]').value.trim();
      if(name && apiUrl) out.push({name, api: apiUrl});
    });
    return out;
  }

  async function loadShorteners(){
    const sess = getAdminToken();
    if(!sess) return showToast("ChÆ°a login", "ÄÄƒng nháº­p Admin trÆ°á»›c.");
    try{
      const d = await api("/api/admin/shorteners", {admin:sess});
      const tb = $("shortTable").querySelector("tbody");
      tb.innerHTML = "";
      const items = Array.isArray(d.items) ? d.items : [];
      items.forEach((x,i)=>tb.appendChild(shortRow(i,x)));
      showToast("ğŸ“¥ Loaded", "ÄÃ£ load danh sÃ¡ch shorteners.");
    }catch(e){
      showToast("âŒ Load fail", e.message || "UNAUTHORIZED");
    }
  }

  async function saveShorteners(){
    const sess = getAdminToken();
    if(!sess) return showToast("ChÆ°a login", "ÄÄƒng nháº­p Admin trÆ°á»›c.");
    const items = getShortItems();
    try{
      await api("/api/admin/shorteners", {method:"POST", admin:sess, body:{items}});
      showToast("ğŸ’¾ Saved", "ÄÃ£ lÆ°u danh sÃ¡ch shorteners.");
    }catch(e){
      showToast("âŒ Save fail", e.message || "UNAUTHORIZED");
    }
  }

  function addShortRow(){
    const tb = $("shortTable").querySelector("tbody");
    tb.appendChild(shortRow(tb.children.length, {name:"",api:""}));
    renumberShort();
  }

  function clearShort(){
    $("shortTable").querySelector("tbody").innerHTML="";
    showToast("ğŸ§¹ Cleared", "ÄÃ£ xÃ³a háº¿t (chÆ°a Save).");
  }

  // ===== Announce =====
  async function setAnnounceChannel(){
    const sess = getAdminToken();
    if(!sess) return showToast("ChÆ°a login", "ÄÄƒng nháº­p Admin trÆ°á»›c.");
    const channel_id = ($("announceChannel").value||"").trim();
    if(!channel_id) return showToast("Thiáº¿u Channel ID", "Nháº­p Channel ID.");
    try{
      const d = await api("/api/admin/announce_channel", {method:"POST", admin:sess, body:{channel_id}});
      $("announceOut").textContent = JSON.stringify(d, null, 2);
      showToast("âœ… Saved", "ÄÃ£ lÆ°u kÃªnh thÃ´ng bÃ¡o.");
    }catch(e){
      showToast("âŒ Fail", e.message || "UNAUTHORIZED");
    }
  }

  async function sendAnnounce(){
    const sess = getAdminToken();
    if(!sess) return showToast("ChÆ°a login", "ÄÄƒng nháº­p Admin trÆ°á»›c.");
    const content = ($("announceText").value||"").trim();
    if(!content) return showToast("Thiáº¿u ná»™i dung", "Nháº­p ná»™i dung broadcast.");
    try{
      const d = await api("/api/admin/announce", {method:"POST", admin:sess, body:{content}});
      $("announceOut").textContent = JSON.stringify(d, null, 2);
      showToast("ğŸš€ Sent", "ÄÃ£ gá»­i thÃ´ng bÃ¡o.");
    }catch(e){
      showToast("âŒ Fail", e.message || "UNAUTHORIZED");
    }
  }

  // ===== Utilities =====
  function escapeHtml(s){
    return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;");
  }
  async function copyText(t){
    try{
      await navigator.clipboard.writeText(t);
      showToast("ğŸ“‹ Copied", "ÄÃ£ copy vÃ o clipboard.");
    }catch(e){
      showToast("âš ï¸ Copy fail", "TrÃ¬nh duyá»‡t cháº·n clipboard. HÃ£y copy thá»§ cÃ´ng.");
    }
  }

  // ===== Wire events =====
  document.querySelectorAll(".navBtn").forEach(btn=>{
    btn.addEventListener("click", ()=> switchPage(btn.dataset.page));
  });

  $("btnSaveApi").onclick = ()=>{ setApiBase($("apiBaseInput").value); showToast("ğŸ’¾ Saved", "ÄÃ£ lÆ°u API Base."); };
  $("btnCheckApi").onclick = checkHealth;
  $("btnHealth").onclick = checkHealth;
  $("btnOpenHealth").onclick = ()=>{
    const base = getApiBase();
    if(!base) return showToast("Thiáº¿u API Base", "HÃ£y dÃ¡n API Base trÆ°á»›c.");
    window.open(base + "/api/health", "_blank");
  };

  $("btnUserLogin").onclick = userLogin;
  $("btnUserFetch").onclick = userFetch;
  $("btnUserLogout").onclick = userLogout;
  $("btnResetToken").onclick = userResetToken;
  $("btnCopyToken").onclick = ()=> copyText(getUserToken() || $("userTokenInput").value.trim());

  $("btnAdminLogin").onclick = adminLogin;
  $("btnAdminOverview").onclick = adminOverview;
  $("btnAdminLogout").onclick = adminLogout;

  $("btnLookup").onclick = adminLookup;
  $("btnCopyUserJson").onclick = ()=> copyText($("lookupOut").textContent || "{}");
  $("btnAddCoin").onclick = adminAddCoin;

  $("btnBand").onclick = adminBand;
  $("btnListBand").onclick = adminBandList;
  $("btnUnband").onclick = adminUnband;

  $("btnLoadShort").onclick = loadShorteners;
  $("btnSaveShort").onclick = saveShorteners;
  $("btnAddShort").onclick = addShortRow;
  $("btnClearShort").onclick = clearShort;

  $("btnSetChannel").onclick = setAnnounceChannel;
  $("btnSendAnn").onclick = sendAnnounce;

  $("btnLogoutAll").onclick = ()=>{
    userLogout();
    adminLogout();
    showToast("ğŸšª Logout", "ÄÃ£ Ä‘Äƒng xuáº¥t toÃ n bá»™.");
  };

  // ===== Initial =====
  (function init(){
    // Restore API base + tokens
    const base = localStorage.getItem(LS.apiBase) || "";
    if(base) $("apiBaseInput").value = normalizeApiBase(base);

    const u = getUserToken();
    if(u) $("userTokenInput").value = u;

    if(getAdminToken()){
      $("adminState").textContent = "âœ… Ä‘Ã£ Ä‘Äƒng nháº­p";
      $("adminState").className = "good";
    }

    // Hash routing
    const p = (location.hash||"").replace("#","") || "home";
    switchPage(p && pages.includes(p) ? p : "home");

    // Quick health auto
    setTimeout(checkHealth, 450);
  })();
</script>
</body>
</html>
